{% load static %}
{% block content %}
<div class="grid grid-cols-1 md:grid-cols-3 gap-6 bg-black rounded-xl overflow-hidden shadow-2xl border border-neon-600">
  <!-- Left: Neon Profile Card -->
<div class="bg-gradient-to-br text-white flex flex-col items-center justify-center py-8 px-4"
     style="background-image: linear-gradient(to bottom right, #1fb904, #0a8d36, #000000);">
  <img src="https://i.pinimg.com/736x/43/44/45/434445fd47baf8a3362a88261ed13ec9.jpg" alt="Profile Photo"
    class="w-32 h-32 rounded-full border-4 border-neon-400 shadow-lg object-cover mb-4" />
  <h3 class="text-2xl font-semibold text-center text-white break-words px-2">
    {{ profile.full_name|default:"Your Name" }}
  </h3>
  {% if profile.created_at %}
  <p class="text-sm text-white mt-2">Joined on: {{ profile.created_at|date:"F j, Y" }}</p>
  {% endif %}
</div>



  <!-- Right: Form Fields -->
  <div class="md:col-span-2 p-6 bg-black text-white">
    <h2 class="text-2xl font-bold text-center text-neon-300 mb-6">
      {% if is_editing %}Edit Your Profile{% else %}Create Your Profile{% endif %}
    </h2>

    {% if messages %}
    <div class="mb-4 text-center">
      {% for message in messages %}
      <p class="text-{{ message.tags }}-400">{{ message }}</p>
      {% endfor %}
    </div>
    {% endif %}

    <form id="edit-profile-form" method="post" action="{% url 'edit_profile' %}" class="space-y-6" enctype="multipart/form-data">
      {% csrf_token %}

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Full Name -->
        <div>
          <label for="full_name" class="block text-sm font-medium text-neon-400">Full Name</label>
          <input type="text" name="full_name" id="full_name" value="{{ form.full_name.value }}"
            class="mt-1 w-full px-4 py-2 bg-gray-900 text-neon-100 border border-neon-600 rounded-md focus:ring-neon-500 focus:border-neon-500 sm:text-sm">
        </div>

        <!-- Age -->
        <div>
          <label for="age" class="block text-sm font-medium text-neon-400">Age</label>
          <input type="number" name="age" id="age" value="{{ form.age.value }}"
            class="mt-1 w-full px-4 py-2 bg-gray-900 text-neon-100 border border-neon-600 rounded-md focus:ring-neon-500 focus:border-neon-500 sm:text-sm">
        </div>

        <!-- Gender -->
        <div>
          <label for="gender" class="block text-sm font-medium text-neon-400">Gender</label>
          <select name="gender" id="gender"
            class="mt-1 w-full px-4 py-2 bg-gray-900 text-neon-100 border border-neon-600 rounded-md focus:ring-neon-500 focus:border-neon-500 sm:text-sm">
            {% for value, name in form.gender.field.choices %}
            <option value="{{ value }}" {% if form.gender.value == value %}selected{% endif %}>{{ name }}</option>
            {% endfor %}
          </select>
        </div>

        <!-- Height -->
        <div>
          <label for="height" class="block text-sm font-medium text-neon-400">Height (cm)</label>
          <input type="number" step="0.1" name="height" id="height" value="{{ form.height.value }}"
            class="mt-1 w-full px-4 py-2 bg-gray-900 text-neon-100 border border-neon-600 rounded-md focus:ring-neon-500 focus:border-neon-500 sm:text-sm">
        </div>

        <!-- Weight -->
        <div>
          <label for="weight" class="block text-sm font-medium text-neon-400">Weight (kg)</label>
          <input type="number" step="0.1" name="weight" id="weight" value="{{ form.weight.value }}"
            class="mt-1 w-full px-4 py-2 bg-gray-900 text-neon-100 border border-neon-600 rounded-md focus:ring-neon-500 focus:border-neon-500 sm:text-sm">
        </div>

        <!-- Activity Level -->
        <div>
          <label for="activity_level" class="block text-sm font-medium text-neon-400">Activity Level</label>
          <select name="activity_level" id="activity_level"
            class="mt-1 w-full px-4 py-2 bg-gray-900 text-neon-100 border border-neon-600 rounded-md focus:ring-neon-500 focus:border-neon-500 sm:text-sm">
            {% for value, name in form.activity_level.field.choices %}
            <option value="{{ value }}" {% if form.activity_level.value == value %}selected{% endif %}>{{ name }}</option>
            {% endfor %}
          </select>
        </div>
      </div>

      <!-- Goal -->
      <div>
        <label for="goal" class="block text-sm font-medium text-neon-400">Primary Goal</label>
        <select name="goal" id="goal"
          class="mt-1 w-full px-4 py-2 bg-gray-900 text-neon-100 border border-neon-600 rounded-md focus:ring-neon-500 focus:border-neon-500 sm:text-sm">
          {% for value, name in form.goal.field.choices %}
          <option value="{{ value }}" {% if form.goal.value == value %}selected{% endif %}>{{ name }}</option>
          {% endfor %}
        </select>
      </div>

      <!-- Submit Button -->
      <div class="flex justify-end pt-4">
        <a href="{% url 'profile' %}"
          class="inline-flex items-center px-6 py-2 border border-neon-500 text-neon-300 bg-gray-800 hover:bg-gray-700 rounded-md text-sm shadow transition-all duration-300">
          Cancel
        </a>
        <button type="submit" id="save-button"
          class="ml-3 inline-flex items-center justify-center px-6 py-2 bg-neon-600 hover:bg-neon-700 text-white font-medium rounded-md shadow-md hover:shadow-neon-500/50 focus:outline-none focus:ring-2 focus:ring-neon-500 transition-all duration-300">
          <span id="save-button-text">Save Changes</span>
          <svg id="save-loading" class="hidden ml-2 w-5 h-5 animate-spin text-white" xmlns="http://www.w3.org/2000/svg"
            fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor"
              d="M4 12a8 8 0 018-8v4l3-3-3-3v4a8 8 0 00-8 8h4l-3 3 3 3H4a8 8 0 01-8-8z">
            </path>
          </svg>
        </button>
      </div>
    </form>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const form = document.getElementById("edit-profile-form");
    const saveButton = document.getElementById("save-button");
    const saveButtonText = document.getElementById("save-button-text");
    const saveLoading = document.getElementById("save-loading");

    form.addEventListener("submit", function (e) {
      e.preventDefault();

      const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
      const formData = new FormData(form);
      const jsonData = {};

      formData.forEach((value, key) => {
        jsonData[key] = value;
      });

      saveButton.disabled = true;
      saveButtonText.textContent = "Saving...";
      saveLoading.classList.remove("hidden");

      fetch("{% url 'edit_profile' %}", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-CSRFToken": csrfToken
        },
        body: JSON.stringify(jsonData)
      })
        .then(response => response.json())
        .then(data => {
          saveButton.disabled = false;
          saveButtonText.textContent = "Save Changes";
          saveLoading.classList.add("hidden");

          if (data.success) {
            window.location.href = "{% url 'profile' %}";
          } else {
            alert("Error: " + (data.message || "Something went wrong."));
          }
        })
        .catch(error => {
          saveButton.disabled = false;
          saveButtonText.textContent = "Save Changes";
          saveLoading.classList.add("hidden");
          console.error("Error:", error);
          alert("An error occurred.");
        });
    });
  });
</script>
{% endblock %}
